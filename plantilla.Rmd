---
title: "Partición de la variación en comunidades de ácaros: influencia ambiental y espacial"
author:
  - "Lisanny de la Rosa (Matrícula 100675664)"
course: "Biogeografía (GEO-131)"
practice: "Práctica: Técnicas de ecología numérica con *datasets* de R"
date: "`r format(Sys.Date(), '%Y-%m-%d')`"
output:
  bookdown::pdf_document2:
    # toc: true
    # toc_depth: 3
    number_sections: false
    fig_caption: yes
always_allow_html: true
bibliography: referencias.bib 
csl: apa(1).csl 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  comment = "#>",
  fig.width = 7,
  fig.height = 5,
  out.width = "100%"
)
set.seed(123)

# Paquetes (ajusta según el ejercicio elegido)
pkg_needed <- c("vegan", "cluster", "indicspecies", "adespatial",
                "iNEXT", "SpadeR", "ggplot2", "dplyr", "tidyr", "readr")
has_pkg <- sapply(pkg_needed, requireNamespace, quietly = TRUE)
if (!all(has_pkg)) {
  message("Paquetes no críticos ausentes (se omitirán bloques opcionales): ",
          paste(names(has_pkg)[!has_pkg], collapse = ", "))
}
invisible(sapply(names(has_pkg)[has_pkg], library, character.only = TRUE))
```

<!-- ===========================================================
REGLAS DE LA PRÁCTICA (resumen operativo)
- Producto: manuscrito reproducible + presentación oral (17 + 3).
- Individual o pareja: cada integrante debe dominar todo.
- IA: se permite como apoyo, pero TODO debe ser verificable y trazable.
- Puedes usar esta plantilla o cualquier otra de tu preferencia.
- El código que aparece en esta plantilla es una base de ejemplo genérica, probablemente no aplica a tu caso.
=========================================================== -->

# Resumen (Abstract)

> **Escribe 150–250 palabras.**
> Incluye: (i) problema, (ii) datos, (iii) técnica principal, (iv) 1–2 hallazgos, (v) conclusión principal y 1 limitación.

**Palabras clave:** `palabra1; palabra2; palabra3; ...`

# 1. Introducción



## 1.2. Problema y justificación

El análisis de comunidades biológicas enfrenta el reto de distinguir entre los efectos ambientales y los efectos espaciales en la distribución de las especies. En el caso de los ácaros que habitan en musgos, resulta complejo determinar si su presencia y abundancia se deben principalmente a condiciones del sustrato (densidad, humedad, tipo) o a la proximidad espacial entre sitios de muestreo. Este problema es relevante porque la falta de claridad puede llevar a interpretaciones erróneas sobre los factores que realmente controlan la biodiversidad en un ecosistema.




## 1.3. Recorrido teórico mínimo exigido (checklist)


**AED/EDA**  
Se realizó una exploración inicial de los datos de abundancia de ácaros en musgos (*mite*), verificando la distribución de especies y posibles valores extremos. Cada fila representa un sitio de muestreo y cada columna una especie, lo que permite identificar patrones de abundancia y rareza.  

**Transformaciones**  
Se aplicó la transformación de **Hellinger** a la matriz de abundancias, lo cual reduce el peso de especies muy dominantes y facilita el uso de técnicas basadas en distancias euclidianas.  

**Distancias y justificación**  
La transformación Hellinger permite trabajar con la **distancia euclidiana**, que es adecuada para análisis de partición de varianza y métodos lineales. En otros contextos, Bray–Curtis o Jaccard serían alternativas, pero aquí la elección se justifica por la compatibilidad con el método.  

**Técnica principal**  
La técnica principal es la **partición de varianza (varpart)**, que descompone la variación en la comunidad en fracciones explicadas por variables ambientales y espaciales.  

**Limitaciones de la técnica**  
- Supone que las variables ambientales y espaciales seleccionadas son representativas.  
- No capta procesos biológicos no medidos (ej. interacciones entre especies).  
- La fracción no explicada puede ser alta, reflejando limitaciones en los datos.  

**Interpretación**  
La interpretación se centra en los diagramas de partición de varianza, donde se visualizan las fracciones explicadas por ambiente, espacio y su intersección. No se utilizan biplots en este caso, pero sí diagramas de Venn.  

**Escala y muestreo**  
Cada muestra corresponde a un sitio de musgo muestreado, con coordenadas espaciales (x, y) y variables ambientales asociadas.  

**Implicaciones biogeográficas/ecológicas**  
El análisis permite inferir si la distribución de ácaros está más determinada por condiciones locales (densidad, humedad, tipo de sustrato) o por la proximidad espacial. Esto aporta información sobre procesos de dispersión y control ambiental en comunidades microartrópodas.  

**Reproducibilidad**  
El análisis es reproducible en R mediante el paquete **vegan**, con un pipeline que incluye: carga de datos, transformación Hellinger, construcción de polinomios espaciales y aplicación de `varpart`. Se recomienda fijar semillas (`set.seed()`) para garantizar replicabilidad en pasos aleatorios.  


# 2. Materiales y métodos

## 2.1. Datos

### 2.1.1. Dataset y origen

En este ejercicio se utiliza el dataset mite, acompañado de sus tablas asociadas mite.env y mite.xy, disponibles en el paquete vegan de R.

**mite**: matriz de abundancias de especies de ácaros recolectados en muestras de musgo.

**mite.env**: variables ambientales medidas en los mismos sitios de muestreo (densidad del sustrato, contenido de agua y tipo de sustrato).

**mite.xy**: coordenadas espaciales de los sitios de muestreo, que permiten analizar patrones espaciales.

Este conjunto de datos fue recolectado originalmente por Daniel Borcard (1989) y ha sido ampliamente utilizado en estudios de ecología numérica y análisis de comunidades, especialmente en la demostración de técnicas de partición de varianza y análisis espacial.


```{r datos-origen}
data(mite); data(mite.env); data(mite.xy)
Y <- decostand(mite, "hellinger")
# Polinomios espaciales (x, y, x^2, y^2, xy)
S <- with(mite.xy, data.frame(x, y, x2 = x^2, y2 = y^2, xy = x*y))
vpart <- varpart(Y, mite.env[,c("SubsDens","WatrCont","Substrate")], S)
vpart


#> Partition of variance in RDA 
#> 
#> Call: varpart(Y = Y, X = mite.env[, c("SubsDens", "WatrCont",
#> "Substrate")], S)
#> 
#> Explanatory tables:
#> X1:  mite.env[, c("SubsDens", "WatrCont", "Substrate")]
#> X2:  S 
#> 
#> No. of explanatory tables: 2 
#> Total variation (SS): 27.205 
#>             Variance: 0.39428 
#> No. of observations: 70 
#> 
#> Partition table:
#>                      Df R.squared Adj.R.squared Testable
#> [a+c] = X1            8   0.42839       0.35343     TRUE
#> [b+c] = X2            5   0.35495       0.30455     TRUE
#> [a+b+c] = X1+X2      13   0.54761       0.44259     TRUE
#> Individual fractions                                    
#> [a] = X1|X2           8                 0.13804     TRUE
#> [b] = X2|X1           5                 0.08916     TRUE
#> [c]                   0                 0.21539    FALSE
#> [d] = Residuals                         0.55741    FALSE
#> ---
```

### 2.1.2. Diseño de muestreo y variables

> Describe: unidad muestral, variables biológicas (respuesta) y ambientales (explicativas), tipos de variables, rangos, NA, etc.

```{r datos-inspeccion}
# TODO: inspección mínima
# str(...)
# summary(...)
# head(...)
```

### 2.1.3. Limitaciones del dataset

> Señala limitaciones **reales** (tamaño muestral, sesgos, variables omitidas, representatividad, escalas, etc.).

## 2.2. Preparación de datos (decisiones analíticas)

### 2.2.1. Limpieza y manejo de NA

```{r limpieza}
# TODO: decisiones de NA / filtrados (justifica en texto)
```

### 2.2.2. Transformaciones y estandarización

> Explica qué transformación aplicas y **por qué**.

```{r transformaciones}
# TODO: transformación (e.g., decostand(..., "hellinger"))
```

### 2.2.3. Medida(s) de distancia (si aplica)

> Declara la(s) distancia(s) y justifica (tipo de datos, objetivo, supuestos).

```{r distancias}
# TODO: distance matrix (e.g., vegdist(..., method="bray"))
```

## 2.3. Técnica principal (núcleo del ejercicio)

> Describe la técnica, qué responde, qué representa cada salida y sus supuestos.

```{r tecnica-principal}
# TODO: implementa la técnica elegida
# Ejemplos:
# - Ord. no restringida: rda() para PCA, metaMDS() para NMDS
# - Ord. restringida: cca(), capscale()
# - Clustering: hclust()
# - PERMANOVA: adonis2()
# - Diversidad: diversity(), specnumber(), betadiver(), etc.
# - iNEXT: iNEXT()
```

## 2.4. Verificación mínima de supuestos / diagnósticos

> Aquí no se trata de “cumplir por cumplir”: explica **qué chequeas** y qué implica.

```{r supuestos}
# TODO: diagnósticos mínimos según técnica
# - stress (NMDS), eigenvalues, colinealidad, betadisper, etc.
```

## 2.5. Reproducibilidad

> Declara cómo garantizas reproducibilidad: semilla, sesión, orden de ejecución.

```{r session-info}
sessionInfo()
```

# 3. Resultados

> Presenta resultados en el mismo orden que Métodos.
> Cada figura/tabla debe tener: (i) qué muestra, (ii) resultado clave, (iii) vínculo con preguntas.

## 3.1. Resultados del AED

```{r resultados-eda}
# TODO: resúmenes/plots mínimos
```

## 3.2. Resultados de la técnica principal

```{r resultados-tecnica}
# TODO: gráficos/tablas principales
```

## 3.3. Resultados complementarios (opcionales)

```{r resultados-extra}
# TODO: análisis extra si aporta a tus preguntas
```

# 4. Discusión

## 4.1. Respuesta directa a preguntas/hipótesis

> Responde P1, P2, etc., citando evidencia concreta (figuras/tablas).

## 4.2. Interpretación conectada con teoría

> Vuelve a los conceptos del checklist y muestra que los entiendes:
> qué significa el patrón, qué no significa, y bajo qué supuestos.

## 4.3. Implicaciones biogeográficas/ecológicas (y conservación si aplica)

> ¿Qué sugiere tu análisis sobre procesos, filtros ambientales, dispersión, estructura espacial, heterogeneidad?

# 5. Aporte del trabajo

> En 3–6 líneas: ¿qué aporta tu trabajo?
> (Puede ser metodológico: “muestra cómo…”; o conceptual: “sugiere que…”)

# 6. Limitaciones

> Lista 3–6 limitaciones **reales**:

* Dataset (muestra, variables, escala)
* Método (supuestos, sensibilidad a parámetros, distancia, transformación)
* Generalización (qué NO puedes concluir)

# 7. Conclusiones

> 3–6 bullets o un párrafo corto.
> Deben ser defendibles y estar sustentadas en resultados.

# Referencias

<!-- Si usas bibliografía con .bib, activa:
bibliography: referencias.bib
y cita con [@clave] -->

# Apéndice A. Bitácora de decisiones (incluye IA)

> Registra decisiones clave y evidencia de verificación.
> No es “para delatarte”: es para mostrar trazabilidad.

## A.1. Decisiones analíticas

* Transformación elegida: … (por qué)
* Distancia elegida: … (por qué)
* Parámetros clave: … (por qué)
* Alternativas probadas: … (qué cambió)

## A.2. Uso de IA (si aplica)

> Si usaste IA, documenta **qué preguntaste** y **cómo verificaste**.

* Objetivo de la consulta: …
* Resumen de la respuesta recibida: …
* Cómo verifiqué (doc, ayuda de R, manual, paper, etc.): …
* Qué adopté y qué descarté: …

---
